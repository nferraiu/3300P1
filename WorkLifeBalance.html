<html>
    <head>
        <script src="https://d3js.org/d3.v5.min.js"></script>
    </head>
    <body>
        <svg width="700" height="700" id="visualization3"></svg>
        <div id="legend"></div>
        <script>
            vis3 = d3.select("svg#visualization3");
            d3.csv("BetterLifeIndex.csv").then(function(data) {
                life_satisfaction_men = [];
                life_satisfaction_women = [];
                education_men = [];
                education_women = [];
                data.forEach(element => {
                    if (element["Indicator"] == "Life satisfaction" && element["Inequality"] == "Men") {
                        life_satisfaction_men.push(element);
                    } else if (element["Indicator"] == "Life satisfaction" && element["Inequality"] == "Women") {
                        life_satisfaction_women.push(element);
                    }
                    if (element["Indicator"] == "Educational attainment" && element["Inequality"] == "Men") {
                        education_men.push(element);
                    } else if (element["Indicator"] == "Educational attainment" && element["Inequality"] == "Women") {
                        education_women.push(element);
                    } 
                });

                function checkCountries(list1, list2) {
                    list1.forEach(a => {
                        var inBoth = false;
                        list2.forEach(b => {
                            if (a["Country"] == b["Country"]) {
                                inBoth = true;
                            }
                        });
                        if (!inBoth) {
                            list1.pop(a);
                        }
                    });
                }

                if (life_satisfaction_men.length > life_satisfaction_women.length) {
                    checkCountries(life_satisfaction_men, life_satisfaction_women);
                } else {
                    checkCountries(life_satisfaction_women, life_satisfaction_men);
                }
                if (education_men.length > education_women.length) {
                    checkCountries(education_men, education_women);
                } else {
                    checkCountries(education_women, education_men);
                }
                if (education_men.length > life_satisfaction_men) {
                    checkCountries(education_men, life_satisfaction_men);
                    checkCountries(education_women, life_satisfaction_women);
                } else {
                    checkCountries(life_satisfaction_men, education_men);
                    checkCountries(life_satisfaction_women, education_women);
                }
                
                life_men_extent = d3.extent(life_satisfaction_men, d => d["Value"]);
                life_women_extent = d3.extent(life_satisfaction_women, d => d["Value"]);
                edu_men_extent = d3.extent(education_men, d => d["Value"]);
                edu_women_extent = d3.extent(education_women, d => d["Value"]);

                var life_min; 
                var life_max;
                var edu_min;
                var edu_max;
                if (Number(life_men_extent[0]) < Number(life_women_extent[0])) {
                    life_min = Number(life_men_extent[0]);
                } else {
                    life_min = Number(life_women_extent[0]);
                }
                if (Number(life_men_extent[1]) > Number(life_women_extent[1])) {
                    life_max = Number(life_men_extent[1]);
                } else {
                    life_max = Number(life_women_extent[1]);
                }
                if (Number(edu_men_extent[0]) < Number(edu_women_extent[0])) {
                    edu_min = Number(edu_men_extent[0]);
                } else {
                    edu_min = Number(edu_women_extent[0]);
                }
                if (Number(edu_men_extent[1]) > Number(edu_women_extent[1])) {
                    edu_max = Number(edu_men_extent[1]);
                } else {
                    edu_max = Number(edu_women_extent[1]);
                }

                const x_scale = d3.scaleLinear().domain([edu_min, edu_max]).range([0,600]);
                const y_scale = d3.scaleLinear().domain([life_min-0.05, life_max]).range([600,0]);

                let left_axis = d3.axisLeft(y_scale);
                let left_grid = d3.axisLeft(y_scale).tickSize(-610).tickFormat("");

                let bottom_axis = d3.axisBottom(x_scale);
                let bottom_grid = d3.axisBottom(x_scale).tickSize(-610).tickFormat("");

                vis3.append("g")
                    .attr("transform","translate(50,50)")
                    .call(left_axis);
                vis3.append("g")
                    .attr("transform","translate(50,50)")
                    .call(left_grid);
                vis3.append("g")
                    .attr("transform","translate(50,650)")
                    .call(bottom_axis);
                vis3.append("g")
                    .attr("transform","translate(50,650)")
                    .call(bottom_grid);

                life_satisfaction_men.forEach(l => {
                    education_men.forEach(e => {
                        if (l["Country"] == e["Country"]) {
                            vis3.append("circle")
                                .attr("id", "men")
                                .attr("cx", x_scale(e["Value"])+50)
                                .attr("cy", y_scale(l["Value"])+50)
                                .attr("r", 11)
                                .attr("fill", "darkBlue");
                        }
                    });
                });

                life_satisfaction_women.forEach(l => {
                    education_women.forEach(e => {
                        if (l["Country"] == e["Country"]) {
                            vis3.append("circle")
                                .attr("id", "women")
                                .attr("cx", x_scale(e["Value"])+50)
                                .attr("cy", y_scale(l["Value"])+50)
                                .attr("r", 11)
                                .attr("fill", "darkRed");
                        }
                    });
                });

                life_satisfaction_men.forEach(l => {
                    education_men.forEach(e => {
                        if (l["Country"] == e["Country"]) {
                            vis3.append("text")
                                .attr("id", "country_label")
                                .attr("x", x_scale(e["Value"])+50)
                                .attr("y", y_scale(l["Value"])+50+3)
                                .attr("font-size", 8)
                                .attr("font-family", "Arial, Helvetica, sans-serif")
                                .attr("id", "country_label")
                                .style("text-anchor", "middle")
                                .style("fill", "white")
                                .text(e["LOCATION"]);

                        }
                    });
                });

                life_satisfaction_women.forEach(l => {
                    education_women.forEach(e => {
                        if (l["Country"] == e["Country"]) {
                            vis3.append("text")
                                .attr("id", "country_label")
                                .attr("x", x_scale(e["Value"])+50)
                                .attr("y", y_scale(l["Value"])+50+3)
                                .attr("font-size", 8)
                                .attr("id", "country_label")
                                .style("text-anchor", "middle")
                                .style("fill", "white")
                                .attr("font-family", "Arial, Helvetica, sans-serif")
                                .text(e["LOCATION"]);
                        }
                    });
                });
                console.log(life_satisfaction_men);
                vis3.append("text")
                    .attr("transform", "translate(350,685)")
                    .style("text-anchor", "middle")
                    .attr("font-family", "Arial, Helvetica, sans-serif")
                    .attr("font-size", 14)
                    .text("Educational Attainment");

                vis3.append("text")
                    .attr("transform", "translate(20,350)rotate(-90)")
                    .style("text-anchor", "middle")
                    .attr("font-family", "Arial, Helvetica, sans-serif")
                    .attr("font-size", 14)
                    .text("Life Satisfaction Score");
                
                vis3.append("text")
                    .attr("transform", "translate(50,700)")
                    .style("text-anchor", "middle")
                    .attr("font-family", "Arial, Helvetica, sans-serif")
                    .attr("font-size", 14)
                    .style("fill", "darkBlue")
                    .text("Men");
                
                vis3.append("text")
                    .attr("transform", "translate(100,700)")
                    .style("text-anchor", "middle")
                    .attr("font-family", "Arial, Helvetica, sans-serif")
                    .attr("font-size", 14)
                    .style("fill", "darkRed")
                    .text("Women");
                
                vis3.append("text")
                    .attr("transform", "translate(350,30)")
                    .style("text-anchor", "middle")
                    .attr("font-family", "Arial, Helvetica, sans-serif")
                    .attr("font-size", 14)
                    .text("Life Satisfaction Score vs. Educational Attainment");
            });
            
        </script>

    </body>
</html>